{
	"ID": "20250701112633-tay53vo",
	"Spec": "1",
	"Type": "NodeDocument",
	"Properties": {
		"id": "20250701112633-tay53vo",
		"title": "CentOS 6 系统启动流程",
		"type": "doc",
		"updated": "20250701113247"
	},
	"Children": [
		{
			"ID": "20250701112633-fhks693",
			"Type": "NodeThematicBreak",
			"Properties": {
				"id": "20250701112633-fhks693",
				"updated": "20250701112633"
			}
		},
		{
			"ID": "20250701112633-95ryund",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20250701112633-95ryund",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "第一阶段:"
				}
			]
		},
		{
			"ID": "20250701112633-90x96tb",
			"Type": "NodeHeading",
			"HeadingLevel": 4,
			"Properties": {
				"id": "20250701112633-90x96tb",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "BIOS启动引导"
				}
			]
		},
		{
			"ID": "20250701112633-am8h001",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-am8h001",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "主板加电,系统自动载入BIOS(Basic Input Output System)系统"
				}
			]
		},
		{
			"ID": "20250701112633-in4ho4f",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-in4ho4f",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "BIOS载入CMOS,读取CMOS中设定的硬件工作参数"
				}
			]
		},
		{
			"ID": "20250701112633-0xwdzdc",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-0xwdzdc",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "BIOS进行POST自检,对各种硬件设备进行检测."
				}
			]
		},
		{
			"ID": "20250701112633-in6ao7h",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-in6ao7h",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "BIOS进行硬件检测的初始化"
				}
			]
		},
		{
			"ID": "20250701112633-9d68e9s",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-9d68e9s",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "BIOS定义开机设备顺序"
				}
			]
		},
		{
			"ID": "20250701112633-pz5wqvp",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20250701112633-pz5wqvp",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "第二阶段:"
				}
			]
		},
		{
			"ID": "20250701112633-jnofmci",
			"Type": "NodeHeading",
			"HeadingLevel": 4,
			"Properties": {
				"id": "20250701112633-jnofmci",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "bootloader(grub)"
				}
			]
		},
		{
			"ID": "20250701112633-o742m4k",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-o742m4k",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "操作系统启动的第一个重要部分是核心的启动.而核心的启动需要让系统知道核心在哪里."
				}
			]
		},
		{
			"ID": "20250701112633-9yxqpbn",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-9yxqpbn",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "这时需要Boot loader来实现核心的载入."
				}
			]
		},
		{
			"ID": "20250701112633-n0ylqvg",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-n0ylqvg",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "所以BIOS下一步是找到Boot loader并启动."
				}
			]
		},
		{
			"ID": "20250701112633-4vw3ubi",
			"Type": "NodeHeading",
			"HeadingLevel": 4,
			"Properties": {
				"id": "20250701112633-4vw3ubi",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "stage1(MBR)"
				}
			]
		},
		{
			"ID": "20250701112633-yfskgsp",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-yfskgsp",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "通常Boot loader是被固定装载在启动磁盘的第1个扇区(sector)的512字节范围内"
				}
			]
		},
		{
			"ID": "20250701112633-2h30rmi",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-2h30rmi",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "这512字节的区域的名字就叫做MBR(Master Boot Record,主引导记录)"
				}
			]
		},
		{
			"ID": "20250701112633-9gh912j",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-9gh912j",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "linux 5,6使用的Boot loader的名字就叫grub"
				}
			]
		},
		{
			"ID": "20250701112633-zqcy0hy",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-zqcy0hy",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "但由于其特殊性,grub的组成部分是被分散安装在磁盘的多个区域的.第一个扇区512字节中的446字节就是grub的stage1内容."
				}
			]
		},
		{
			"ID": "20250701112633-h7mij9a",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-h7mij9a",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "MBR就是stage1就是第一扇区,其中内容非常简单,仅仅是告诉BIOS,去加载第二扇区的内容并执行"
				}
			]
		},
		{
			"ID": "20250701112633-4r2685h",
			"Type": "NodeHeading",
			"HeadingLevel": 4,
			"Properties": {
				"id": "20250701112633-4r2685h",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "stage1.5"
				}
			]
		},
		{
			"ID": "20250701112633-k9y25xy",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-k9y25xy",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "简单来说第二扇区的内容也很简单,就是去读第三扇区的stage1.5,执行第三扇区内容后,内存中就有了文件系统支撑代码,此时便能够通过文件系统查找文件了."
				}
			]
		},
		{
			"ID": "20250701112633-wdtu1tk",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-wdtu1tk",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "第二扇区的内容有两种情况"
				}
			]
		},
		{
			"ID": "20250701112633-9hnw589",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-9hnw589",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "1)内容是grub的stage1.5,stage1.5的内容与/boot/grub/xxx"
				},
				{
					"Type": "NodeBackslash",
					"Data": "span",
					"Children": [
						{
							"Type": "NodeText",
							"Data": "_"
						}
					]
				},
				{
					"Type": "NodeText",
					"Data": "stage1"
				},
				{
					"Type": "NodeBackslash",
					"Data": "span",
					"Children": [
						{
							"Type": "NodeText",
							"Data": "_"
						}
					]
				},
				{
					"Type": "NodeText",
					"Data": "5文件源码的开头512字节内容相同,xxx是什么取决于启动磁盘的文件系统,比如e2fs"
				},
				{
					"Type": "NodeBackslash",
					"Data": "span",
					"Children": [
						{
							"Type": "NodeText",
							"Data": "_"
						}
					]
				},
				{
					"Type": "NodeText",
					"Data": "stage1"
				},
				{
					"Type": "NodeBackslash",
					"Data": "span",
					"Children": [
						{
							"Type": "NodeText",
							"Data": "_"
						}
					]
				},
				{
					"Type": "NodeText",
					"Data": "5.而这部分内容的作用就是取出第三扇区之后的部分内容,这些内容便是文件系统支撑代码,于是当stage1.5被执行后,系统便可以识别文件系统,并通过文件系统访问磁盘文件了.此后会读取/boot/grub/stage2文件将stage2文件载入系统并执行."
				}
			]
		},
		{
			"ID": "20250701112633-1z7j6i7",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-1z7j6i7",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "2)第二扇区直接加载存放在/boot分区启动扇区的stage2而不是/boot/grub/stage2.此时如/boot/grub/stage2丢失,也不会影响启动.系统默认是这个模式,修复grub时,在grub交互式模式中,使用install命令可以恢复这种模式."
				}
			]
		},
		{
			"ID": "20250701112633-ncwae5n",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-ncwae5n",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "通常我们做实验时第一次删除了/boot/grub/stage2文件后,系统是可以正常启动的.因为默认是上面第二种情况,而通常我们修复的时候使用了grub三种安装方式中的前两种比较快捷方便的方法即: 1.grub-install 2.grub"
				},
				{
					"Type": "NodeBackslash",
					"Data": "span",
					"Children": [
						{
							"Type": "NodeText",
							"Data": "\u003e"
						}
					]
				},
				{
					"Type": "NodeText",
					"Data": "setup ,而这两种方法会把第二扇区恢复为上面的第一种情况.这时如果再删除/boot/grub/stage2文件,则无法启动并且会报 error 15 错误. 如果想恢复到第二种模式,需要使用grub的install命令,即grub的第3种安装方法,grub"
				},
				{
					"Type": "NodeBackslash",
					"Data": "span",
					"Children": [
						{
							"Type": "NodeText",
							"Data": "\u003e"
						}
					]
				},
				{
					"Type": "NodeText",
					"Data": "install. 具体使用方法可以gg暂不详述."
				}
			]
		},
		{
			"ID": "20250701112633-lqafty7",
			"Type": "NodeHeading",
			"HeadingLevel": 4,
			"Properties": {
				"id": "20250701112633-lqafty7",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "stage2"
				}
			]
		},
		{
			"ID": "20250701112633-815zxro",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-815zxro",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "系统执行stage2,stage2会通过grub.conf配置文件生成启动菜单并读取内核,initrd,解压缩并载入内存."
				}
			]
		},
		{
			"ID": "20250701112633-v8a4frj",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20250701112633-v8a4frj",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "第三阶段:"
				}
			]
		},
		{
			"ID": "20250701112633-qc7ct8h",
			"Type": "NodeHeading",
			"HeadingLevel": 4,
			"Properties": {
				"id": "20250701112633-qc7ct8h",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "内核"
				}
			]
		},
		{
			"ID": "20250701112633-o1iid5z",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-o1iid5z",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "此时内核已启动,开始检测硬件,但后续的工作还需要initrd来协助.initrd是一个基于内存的虚拟文件系统 (Initial RAM Filesystem) 在Centos5上的具体文件名为 /boot/initrd ,Centos 6中为 /boot/initramfs ,执行后会生成一个临时根目录,里面包含了除集成在kernel以外的,当前系统所需的各种驱动程序.系统会加载这些驱动,最后释放这个虚拟文件系统,切换到真正的根上并执行系统1号进程/sbin/init."
				}
			]
		},
		{
			"ID": "20250701112633-xaxj7zf",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20250701112633-xaxj7zf",
				"updated": "20250701113247"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "第四阶段:"
				}
			]
		},
		{
			"ID": "20250701112633-tznwbcf",
			"Type": "NodeHeading",
			"HeadingLevel": 4,
			"Properties": {
				"id": "20250701112633-tznwbcf",
				"updated": "20250701113247"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "init"
				}
			]
		},
		{
			"ID": "20250701112633-un59pzg",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-un59pzg",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "init读取配置文件/etc/inittab,按照配置文件执行一系列初始化操作"
				}
			]
		},
		{
			"ID": "20250701112633-ddjmlkp",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-ddjmlkp",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "1.初始化脚本/etc/rc.d/rc.sysinit"
				}
			]
		},
		{
			"ID": "20250701112633-0h71wo2",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-0h71wo2",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "(1) 设置主机名"
				}
			]
		},
		{
			"ID": "20250701112633-9djsqv9",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-9djsqv9",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "(2) 设置欢迎信息"
				}
			]
		},
		{
			"ID": "20250701112633-pkhsum4",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-pkhsum4",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "(3) 激活udev和selinux"
				}
			]
		},
		{
			"ID": "20250701112633-kcecrrc",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-kcecrrc",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "(4) 挂载/etc/fstab文件中定义的文件系统"
				}
			]
		},
		{
			"ID": "20250701112633-akhl2cv",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-akhl2cv",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "(5) 检测根文件系统，并以读写方式重新挂载根文件系统"
				}
			]
		},
		{
			"ID": "20250701112633-8lp8r3z",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-8lp8r3z",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "(6) 设置系统时钟"
				}
			]
		},
		{
			"ID": "20250701112633-tmzu7bw",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-tmzu7bw",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "(7) 激活swap设备"
				}
			]
		},
		{
			"ID": "20250701112633-0yneucp",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-0yneucp",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "(8) 根据/etc/sysctl.conf文件设置内核参数"
				}
			]
		},
		{
			"ID": "20250701112633-gp8btsh",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-gp8btsh",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "(9) 激活lvm及software raid设备"
				}
			]
		},
		{
			"ID": "20250701112633-xa69pif",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-xa69pif",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "(10) 加载额外设备的驱动程序"
				}
			]
		},
		{
			"ID": "20250701112633-lg3dt4g",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-lg3dt4g",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "(11) 清理操作"
				}
			]
		},
		{
			"ID": "20250701112633-eb3wsf9",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-eb3wsf9",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "2.确定运行级别"
				}
			]
		},
		{
			"ID": "20250701112633-arvuqkv",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-arvuqkv",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "3.运行/etc/rc.d/rcN.d/下的服务,N为数字,对应准备启动的系统运行级别,里面的内容为K和S开头的指向/etc/rc.d/init.d目录下的服务脚本.S开头为开机启动的服务,K开头的为关闭当前运行模式时运行需要执行的脚本(切换模式,关机等),S或K后面的数字越小,优先级越高."
				}
			]
		},
		{
			"ID": "20250701112633-lwgq53z",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-lwgq53z",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "4.运行/etc/rc.d/rc.local脚本,这个脚本是用户自定义执行脚本,S99local就是rc.local的软连接."
				}
			]
		},
		{
			"ID": "20250701112633-c73y7ai",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20250701112633-c73y7ai",
				"updated": "20250701112633"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "5.最后执行终端或X-window.之后用户便可以登陆"
				}
			]
		}
	]
}