{
	"ID": "20221230023411-2i2c85b",
	"Spec": "1",
	"Type": "NodeDocument",
	"Properties": {
		"id": "20221230023411-2i2c85b",
		"scroll": "{\u0026quot;startId\u0026quot;:\u0026quot;20221230023411-413mvh6\u0026quot;,\u0026quot;endId\u0026quot;:\u0026quot;20221230023411-9ajsas3\u0026quot;,\u0026quot;scrollTop\u0026quot;:127,\u0026quot;focusId\u0026quot;:\u0026quot;20221230023411-vaarjf8\u0026quot;,\u0026quot;focusStart\u0026quot;:5,\u0026quot;focusEnd\u0026quot;:5}",
		"title": "大规模存储集群监控方案 ",
		"updated": "20221230023446"
	},
	"Children": [
		{
			"ID": "20221230023411-413mvh6",
			"Type": "NodeThematicBreak",
			"Properties": {
				"id": "20221230023411-413mvh6"
			}
		},
		{
			"ID": "20221230023411-q0nc6i2",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20221230023411-q0nc6i2"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "背景"
				}
			]
		},
		{
			"ID": "20221230023411-tz2l03f",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-tz2l03f"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "存储集群因其特殊性，和常规的监控场景有一些不同，需要考虑以下特殊性和限制："
				}
			]
		},
		{
			"ID": "20221230023411-ljotgeg",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20221230023411-ljotgeg"
			},
			"Children": [
				{
					"ID": "20221230023411-azsm1hv",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221230023411-azsm1hv"
					},
					"Children": [
						{
							"ID": "20221230023411-kyiv93p",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221230023411-kyiv93p"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "节点数量大，采集任务多，采集压力大；"
								}
							]
						}
					]
				},
				{
					"ID": "20221230023411-ysqpgve",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221230023411-ysqpgve"
					},
					"Children": [
						{
							"ID": "20221230023411-e1awpvr",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221230023411-e1awpvr"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "无外部对象存储。"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20221230023411-e38oyrj",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20221230023411-e38oyrj"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "核心诉求"
				}
			]
		},
		{
			"ID": "20221230023411-s4valem",
			"Type": "NodeList",
			"ListData": {
				"Typ": 1
			},
			"Properties": {
				"id": "20221230023411-s4valem"
			},
			"Children": [
				{
					"ID": "20221230023411-48ivbg4",
					"Type": "NodeListItem",
					"ListData": {
						"Typ": 1,
						"Delimiter": 46,
						"Marker": "MS4=",
						"Num": 1
					},
					"Properties": {
						"id": "20221230023411-48ivbg4"
					},
					"Children": [
						{
							"ID": "20221230023411-y00fpm0",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221230023411-y00fpm0"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "满足大规模存储集群的组件基础监控和业务层面的监控；"
								}
							]
						}
					]
				},
				{
					"ID": "20221230023411-ihzspmk",
					"Type": "NodeListItem",
					"ListData": {
						"Typ": 1,
						"Delimiter": 46,
						"Marker": "Mi4=",
						"Num": 2
					},
					"Properties": {
						"id": "20221230023411-ihzspmk"
					},
					"Children": [
						{
							"ID": "20221230023411-a808avr",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221230023411-a808avr"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "告警实时推送，并支持自定义告警的发送；"
								}
							]
						}
					]
				},
				{
					"ID": "20221230023411-ggrcunu",
					"Type": "NodeListItem",
					"ListData": {
						"Typ": 1,
						"Delimiter": 46,
						"Marker": "My4=",
						"Num": 3
					},
					"Properties": {
						"id": "20221230023411-ggrcunu"
					},
					"Children": [
						{
							"ID": "20221230023411-2glxk72",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221230023411-2glxk72"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "支持告警规则设置，包括阈值、级别等；"
								}
							]
						}
					]
				},
				{
					"ID": "20221230023411-6sm1hhz",
					"Type": "NodeListItem",
					"ListData": {
						"Typ": 1,
						"Delimiter": 46,
						"Marker": "NC4=",
						"Num": 4
					},
					"Properties": {
						"id": "20221230023411-6sm1hhz"
					},
					"Children": [
						{
							"ID": "20221230023411-9ltsrkl",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221230023411-9ltsrkl"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "告警实时展示；"
								}
							]
						}
					]
				},
				{
					"ID": "20221230023411-yxsjwwt",
					"Type": "NodeListItem",
					"ListData": {
						"Typ": 1,
						"Delimiter": 46,
						"Marker": "NS4=",
						"Num": 5
					},
					"Properties": {
						"id": "20221230023411-yxsjwwt"
					},
					"Children": [
						{
							"ID": "20221230023411-03c6u8t",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221230023411-03c6u8t"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "告警通道支持SNMP Trap、邮件、短信等；"
								}
							]
						}
					]
				},
				{
					"ID": "20221230023411-eoznni9",
					"Type": "NodeListItem",
					"ListData": {
						"Typ": 1,
						"Delimiter": 46,
						"Marker": "Ni4=",
						"Num": 6
					},
					"Properties": {
						"id": "20221230023411-eoznni9"
					},
					"Children": [
						{
							"ID": "20221230023411-e1vqgxv",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221230023411-e1vqgxv"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "告警信息持久化到数据库的能力。"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20221230023411-co3qzg0",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20221230023411-co3qzg0"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "面临的挑战"
				}
			]
		},
		{
			"ID": "20221230023411-vaarjf8",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20221230023411-vaarjf8"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "监控不稳定"
				}
			]
		},
		{
			"ID": "20221230023411-3ye63fy",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-3ye63fy"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "监控组件不稳定"
				},
				{
					"Type": "NodeText",
					"Data": "：原生Prometheus并不支持高可用，也不能做横向扩缩容，无法避免单机性能瓶颈的问题，过大的监控数据经常会造成Prometheus实例出现OOM，同时由于纳管监控对象的过程中会对Prometheus实例进行变更，频繁的变更会触发Prometheus卡死。"
				}
			]
		},
		{
			"ID": "20221230023411-wpp2ki6",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-wpp2ki6"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "监控与业务耦合"
				},
				{
					"Type": "NodeText",
					"Data": "：为避免数据量大造成OOM，需要人工拆分Prometheus实现数据分片，这样不仅增加维护成本，同时由于存在自动纳管的机制，纳管机制与人工分片强耦合，不利于后期运营和功能拓展。"
				}
			]
		},
		{
			"ID": "20221230023411-qg8qzsz",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-qg8qzsz"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "监控链路不稳定"
				},
				{
					"Type": "NodeText",
					"Data": "：当Prometheus出现OOM重启时，由于本地盘存储数据量大，启动加载慢，重启耗时长，经常造成较长时间的数据断点。"
				}
			]
		},
		{
			"ID": "20221230023411-6znxe4i",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-6znxe4i"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "无法动态扩缩容"
				},
				{
					"Type": "NodeText",
					"Data": "：虽然Prometheus可以通过hash_mod的方式进行采集任务的分片，但是该方式需要人工干预，无法动态扩缩容。"
				}
			]
		},
		{
			"ID": "20221230023411-cn0j07j",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20221230023411-cn0j07j"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "运维成本高"
				}
			]
		},
		{
			"ID": "20221230023411-9f9wkgx",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-9f9wkgx"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "监控组件需要自运维：监控数据分片需要人工拆分监控实例，监控组件需要自运维保活，确保监控可用性。"
				}
			]
		},
		{
			"ID": "20221230023411-j59n2c1",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-j59n2c1"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "容量扩展需要人工干预：当单机Prometheus无法满足大量的采集目标处理任务时，会导致OOM重启，此时对于Prometheus的纵向扩展需要人工干预。"
				}
			]
		},
		{
			"ID": "20221230023411-1y5r0qz",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20221230023411-1y5r0qz"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "理想模型"
				}
			]
		},
		{
			"ID": "20221230023411-qnw39cq",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-qnw39cq"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "为了解决上述几个问题，我们需要先构思一个理想模型。"
				}
			]
		},
		{
			"ID": "20221230023411-ixoab52",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-ixoab52"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "采集 - 高性能"
				}
			]
		},
		{
			"ID": "20221230023411-5ga4v5q",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-5ga4v5q"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "在采集侧，我们遇到的问题主要就是性能问题，由于单机Prometheus的性能瓶颈，限制了海量数据采集的能力，我们希望采集侧有以下能力："
				}
			]
		},
		{
			"ID": "20221230023411-f9ctd83",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20221230023411-f9ctd83"
			},
			"Children": [
				{
					"ID": "20221230023411-go0ehk1",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221230023411-go0ehk1"
					},
					"Children": [
						{
							"ID": "20221230023411-tos6sua",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221230023411-tos6sua"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "高性能：有无限性能的采集器；"
								}
							]
						}
					]
				},
				{
					"ID": "20221230023411-j1of805",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221230023411-j1of805"
					},
					"Children": [
						{
							"ID": "20221230023411-5szq59q",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221230023411-5szq59q"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "Prometheus原生：支持Prometheus主流的配置方式，包括Prometheus operator所支持的ServiceMonitor和PodMonitor等。"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20221230023411-a84bld7",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-a84bld7"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "存储 - 长期存储"
				}
			]
		},
		{
			"ID": "20221230023411-idge6ca",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-idge6ca"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "在存储侧，理想模型应该包括以下能力："
				}
			]
		},
		{
			"ID": "20221230023411-awikrt4",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20221230023411-awikrt4"
			},
			"Children": [
				{
					"ID": "20221230023411-gkswull",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221230023411-gkswull"
					},
					"Children": [
						{
							"ID": "20221230023411-4m4ahd1",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221230023411-4m4ahd1"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "具备水平可扩展能力，可支持海量数据存储；"
								}
							]
						}
					]
				},
				{
					"ID": "20221230023411-ri3b01o",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221230023411-ri3b01o"
					},
					"Children": [
						{
							"ID": "20221230023411-jcegxnu",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221230023411-jcegxnu"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "存储资源的利用率高。"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20221230023411-7fhmd9y",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-7fhmd9y"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "查询 - 低延迟"
				}
			]
		},
		{
			"ID": "20221230023411-jzya8pi",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-jzya8pi"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "在查询侧，作为直接面向用户的查询接口，应该具备以下能力："
				}
			]
		},
		{
			"ID": "20221230023411-5z2u2ze",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20221230023411-5z2u2ze"
			},
			"Children": [
				{
					"ID": "20221230023411-k7dzext",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221230023411-k7dzext"
					},
					"Children": [
						{
							"ID": "20221230023411-ax9k450",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221230023411-ax9k450"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "高性能：查询侧水平可扩展，分摊查询压力；"
								}
							]
						}
					]
				},
				{
					"ID": "20221230023411-w8t2y16",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221230023411-w8t2y16"
					},
					"Children": [
						{
							"ID": "20221230023411-kebj5wk",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221230023411-kebj5wk"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "低延迟：提升用户查询体验。"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20221230023411-p8688is",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-p8688is"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "展示 - 全局视图"
				}
			]
		},
		{
			"ID": "20221230023411-3fcj6t7",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-3fcj6t7"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "在展示侧，理想化模型应该具备以下能力："
				}
			]
		},
		{
			"ID": "20221230023411-34dy0zp",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20221230023411-34dy0zp"
			},
			"Children": [
				{
					"ID": "20221230023411-b19ybsf",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221230023411-b19ybsf"
					},
					"Children": [
						{
							"ID": "20221230023411-19eo5d8",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221230023411-19eo5d8"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "支持对接Grafana做大屏展示；"
								}
							]
						}
					]
				},
				{
					"ID": "20221230023411-annim6m",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221230023411-annim6m"
					},
					"Children": [
						{
							"ID": "20221230023411-yldj1t2",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221230023411-yldj1t2"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "支持全局聚合查询。"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20221230023411-1mnydke",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-1mnydke"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "告警 - 原生及扩展"
				}
			]
		},
		{
			"ID": "20221230023411-5ivxzkh",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-5ivxzkh"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "在告警侧，需要具备以下能力："
				}
			]
		},
		{
			"ID": "20221230023411-g6ljc3c",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20221230023411-g6ljc3c"
			},
			"Children": [
				{
					"ID": "20221230023411-w2vxgbt",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221230023411-w2vxgbt"
					},
					"Children": [
						{
							"ID": "20221230023411-cqwtp27",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221230023411-cqwtp27"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "支持Prometheus原生的告警配置；"
								}
							]
						}
					]
				},
				{
					"ID": "20221230023411-h6npnry",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221230023411-h6npnry"
					},
					"Children": [
						{
							"ID": "20221230023411-1q9xk7p",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221230023411-1q9xk7p"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "告警通道可扩展。"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20221230023411-ub98e2f",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-ub98e2f"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "运维 - 便捷"
				}
			]
		},
		{
			"ID": "20221230023411-ucezes8",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-ucezes8"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "使用Kubernetes原生方式进行管理，降低运维复杂性。"
				}
			]
		},
		{
			"ID": "20221230023411-txr851c",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20221230023411-txr851c"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "解决方案"
				}
			]
		},
		{
			"ID": "20221230023411-3s6xh0x",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20221230023411-3s6xh0x"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "采集端 - 实现可分片高可用Prometheus"
				}
			]
		},
		{
			"ID": "20221230023411-u7xw7mi",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-u7xw7mi"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "当采集大量目标时，单机Prometheus的性能瓶颈是我们亟待解决的问题，我们需要修改Prometheus以让其支持横向扩缩容。"
				}
			]
		},
		{
			"ID": "20221230023411-vsqj8wp",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-vsqj8wp"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "设计原则"
				}
			]
		},
		{
			"ID": "20221230023411-pav2550",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-pav2550"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "对于采集端Prometheus的修改，我们希望具备以下能力："
				}
			]
		},
		{
			"ID": "20221230023411-o7bs0e7",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20221230023411-o7bs0e7"
			},
			"Children": [
				{
					"ID": "20221230023411-lwr2cnk",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221230023411-lwr2cnk"
					},
					"Children": [
						{
							"ID": "20221230023411-fctkley",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221230023411-fctkley"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "根据采集任务量，实现动态扩缩容；"
								}
							]
						}
					]
				},
				{
					"ID": "20221230023411-e7zftt4",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221230023411-e7zftt4"
					},
					"Children": [
						{
							"ID": "20221230023411-dauwz8o",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221230023411-dauwz8o"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "多个Prometheus采集器之间实现采集任务的负载均衡；"
								}
							]
						}
					]
				},
				{
					"ID": "20221230023411-mrdv7jg",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221230023411-mrdv7jg"
					},
					"Children": [
						{
							"ID": "20221230023411-srg364w",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221230023411-srg364w"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "完全兼容原来的配置文件即采集能力。"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20221230023411-0lg87ng",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-0lg87ng"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "通过调研，社区开源组件"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "a",
					"TextMarkAHref": "https://github.com/tkestack/kvass/blob/master/README_CN.md",
					"TextMarkTextContent": "kvass"
				},
				{
					"Type": "NodeText",
					"Data": "可以满足我们的需求，kvass是一个Prometheus横向扩容解决方案，使用Sidecar动态的根据Coordinator分配下来的target列表来为每个Prometheus生成只含特定target的配置文件，从而将采集任务动态调度到各个Prometheus分片。Coordinator 用于服务发现，target调度和分片扩缩容管理。TSDB用来将分片数据汇总成全局数据。"
				}
			]
		},
		{
			"ID": "20221230023411-9jmybz7",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-9jmybz7"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "简单来说，就是由独立组件（Coordinator）做服务发现，并把target集合及数据规模提前探测出来，直接分配给几个Prometheus去抓取，分片不再进行服务发现，只负责数据抓取。"
				}
			]
		},
		{
			"ID": "20221230023411-vlsf0iw",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20221230023411-vlsf0iw"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "存储端 - 远程统一存储"
				}
			]
		},
		{
			"ID": "20221230023411-fz93w20",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-fz93w20"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "由于在采集端将采集任务分片，所以在存储端，我们需要一个统一的存储来将分片化的Prometheus数据进行存储。业界在这方面有不少优秀的开源项目，我们选取目前比较知名的两个项目，从架构、接入方式、存储、性能、资源需求等方面做比较。"
				}
			]
		},
		{
			"ID": "20221230023411-h8xc09u",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20221230023411-h8xc09u"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "Thanos vs VictoriaMetrics"
				}
			]
		},
		{
			"ID": "20221230023411-xiewxcx",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-xiewxcx"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "整体比较"
				}
			]
		},
		{
			"ID": "20221230023411-z15ur0o",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-z15ur0o"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "Thanos是社区十分流行的Prometheus高可用解决方案，其整体架构如图所示："
				}
			]
		},
		{
			"ID": "20221230023411-wdnhwyy",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-wdnhwyy"
			},
			"Children": [
				{
					"Type": "NodeImage",
					"Data": "span",
					"Children": [
						{
							"Type": "NodeBang"
						},
						{
							"Type": "NodeOpenBracket"
						},
						{
							"Type": "NodeLinkText",
							"Data": "Receive"
						},
						{
							"Type": "NodeCloseBracket"
						},
						{
							"Type": "NodeOpenParen"
						},
						{
							"Type": "NodeLinkDest",
							"Data": "https://docs.google.com/drawings/d/e/2PACX-1vTfko27YB_3ab7ZL8ODNG5uCcrpqKxhmqaz3lW-yhGN3_oNxkTrqXmwwlcZjaWf3cGgAJIM4CMwwkEV/pub?w=960\u0026h=720"
						},
						{
							"Type": "NodeCloseParen"
						}
					]
				}
			]
		},
		{
			"ID": "20221230023411-otihxzy",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-otihxzy"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "从采集侧看，Prometheus将采集的数据远程写到Thanos Receiver组件，采集Prometheus可以有多个，各自上报各自采集到的数据。"
				}
			]
		},
		{
			"ID": "20221230023411-hgg6iay",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-hgg6iay"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "查询时，Thanos query组件通过Store API在各数据存储组件中查询数据并做聚合、去重，然后返回给客户端。"
				}
			]
		},
		{
			"ID": "20221230023411-3y9c642",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-3y9c642"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "而VictoriaMetrics是一个快速、经济、可扩展的监控解决方案和时间序列数据库。官方宣传其相比较于Thanos等有更加强大的性能，其整体架构如下图所示："
				}
			]
		},
		{
			"ID": "20221230023411-oc8ygzf",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-oc8ygzf"
			},
			"Children": [
				{
					"Type": "NodeImage",
					"Data": "span",
					"Children": [
						{
							"Type": "NodeBang"
						},
						{
							"Type": "NodeOpenBracket"
						},
						{
							"Type": "NodeLinkText"
						},
						{
							"Type": "NodeCloseBracket"
						},
						{
							"Type": "NodeOpenParen"
						},
						{
							"Type": "NodeLinkDest",
							"Data": "https://docs.google.com/drawings/d/e/2PACX-1vTvk2raU9kFgZ84oF-OKolrGwHaePhHRsZEcfQ1I_EC5AB_XPWwB392XshxPramLJ8E4bqptTnFn5LL/pub?w=1104\u0026h=746"
						},
						{
							"Type": "NodeCloseParen"
						}
					]
				}
			]
		},
		{
			"ID": "20221230023411-3l2nao1",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-3l2nao1"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "从架构上来看，Thanos比VictoriaMetrics要复杂一些，且需要依赖于外部对象存储。"
				}
			]
		},
		{
			"ID": "20221230023411-74y4yqb",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-74y4yqb"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "从接入方式看，Thanos和VictoriaMetrics都可以作为Prometheus的远程存储，只需要在Prometheus的配置文件中指定remote_write地址即可，两者的接入方式没有差别。"
				}
			]
		},
		{
			"ID": "20221230023411-xor61sa",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-xor61sa"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "从存储类型看，VictoriaMetrics使用本地文件系统作为存储，而Thanos需要对接外部对象存储，虽然现在Thanos也支持本地文件系统，但是该存储类型是实验性的，只要用于测试和演示，官方不建议将其用作生产环境中指标的主存储。"
				}
			]
		},
		{
			"ID": "20221230023411-q38v2na",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-q38v2na"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "从性能表现看，由于使用本地文件系统作为存储，不受网络质量的影响，VictoriaMetrics的查询性能比Thanos更好。"
				}
			]
		},
		{
			"ID": "20221230023411-ndm19xm",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-ndm19xm"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "从资源需求看，VictoriaMetrics使用更优的压缩算法，在处理和存储相同数量的时序序列时，VictoriaMetrics所使用的RAM和存储空间比Thanos少7倍。"
				}
			]
		},
		{
			"ID": "20221230023411-i6uxfhx",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-i6uxfhx"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "选型"
				}
			]
		},
		{
			"ID": "20221230023411-uuqs2b9",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-uuqs2b9"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "从以上分析来看，并且由于存储集群的特殊性（无可用外部对象存储，只能使用本地文件系统），VictoriaMetrics是更合适的选择。"
				}
			]
		},
		{
			"ID": "20221230023411-mhassq8",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20221230023411-mhassq8"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "配置管理"
				}
			]
		},
		{
			"ID": "20221230023411-t3ry4ah",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-t3ry4ah"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "对于告警规则和告警通道的配置管理，运维中心已经支持这部分功能，可以考虑复用。"
				}
			]
		},
		{
			"ID": "20221230023411-v1gw2br",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20221230023411-v1gw2br"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "告警通道"
				}
			]
		},
		{
			"ID": "20221230023411-a32iq8e",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-a32iq8e"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "Alertmanager原生支持以下的通知方式："
				}
			]
		},
		{
			"ID": "20221230023411-ce82bvl",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-ce82bvl"
			},
			"Children": [
				{
					"Type": "NodeImage",
					"Data": "span",
					"Children": [
						{
							"Type": "NodeBang"
						},
						{
							"Type": "NodeOpenBracket"
						},
						{
							"Type": "NodeLinkText"
						},
						{
							"Type": "NodeCloseBracket"
						},
						{
							"Type": "NodeOpenParen"
						},
						{
							"Type": "NodeLinkDest",
							"Data": "assets/image2022-4-2_11-3-38-20221230023411-m9nsx0g.png"
						},
						{
							"Type": "NodeCloseParen"
						}
					]
				}
			]
		},
		{
			"ID": "20221230023411-9ajsas3",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-9ajsas3"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "对于不支持的通知方式（如SNMP Trap、短信等），可以考虑使用webhook方式将告警发送到消息通知中心，由消息通知中心转发，这也是目前我们的实现方式，但是现在对接的消息通知中心只支持邮件，如果有更多告警通道的需求，需要考虑自研消息通知中心。"
				}
			]
		},
		{
			"ID": "20221230023411-s6xgd5u",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20221230023411-s6xgd5u"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "数据持久化"
				}
			]
		},
		{
			"ID": "20221230023411-045yfyd",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-045yfyd"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "对于历史告警数据，Alertmanager并不具备持久化的能力，我们需要在告警发出时对其做记录，Alertmanager官方推荐"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "a",
					"TextMarkAHref": "https://github.com/yakshaving-art/alertsnitch",
					"TextMarkTextContent": "AlertSnitch"
				},
				{
					"Type": "NodeText",
					"Data": "将历史告警信息存储到数据库中。"
				}
			]
		},
		{
			"ID": "20221230023411-fsmld6e",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20221230023411-fsmld6e"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "架构设计"
				}
			]
		},
		{
			"ID": "20221230023411-n2g2ktp",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20221230023411-n2g2ktp"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "架构图"
				}
			]
		},
		{
			"ID": "20221230023411-8wlkljc",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-8wlkljc"
			},
			"Children": [
				{
					"Type": "NodeImage",
					"Data": "span",
					"Children": [
						{
							"Type": "NodeBang"
						},
						{
							"Type": "NodeOpenBracket"
						},
						{
							"Type": "NodeLinkText"
						},
						{
							"Type": "NodeCloseBracket"
						},
						{
							"Type": "NodeOpenParen"
						},
						{
							"Type": "NodeLinkDest",
							"Data": "assets/image2022-4-2_11-4-2-20221230023411-rhuuo1m.png"
						},
						{
							"Type": "NodeCloseParen"
						}
					]
				}
			]
		},
		{
			"ID": "20221230023411-ii6h154",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-ii6h154"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "整个架构采用分层设计，各层之间没有强依赖，可以进行独立容量扩展。"
				}
			]
		},
		{
			"ID": "20221230023411-kulzfk6",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-kulzfk6"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "采集层"
				}
			]
		},
		{
			"ID": "20221230023411-s2ltx5d",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-s2ltx5d"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "通过在Prometheus旁边加上Kvass Sidecar来实现Prometheus的横向扩缩容，Kvass Coordinator加载全局配置文件并进行服务发现，获取所有的target，对于每个需要采集的target，Coordinator为其进行relabel_configs，并且探测target当前包含的series数，Coordinator周期性的下推新target，转移target，以及进行分片的扩缩容。Prometheus根据Coordinator下推的配置进行数据采集并且remote write到远程的TSDB做统一存储。"
				}
			]
		},
		{
			"ID": "20221230023411-hs1nkkw",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-hs1nkkw"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "存储层"
				}
			]
		},
		{
			"ID": "20221230023411-wwqvv6z",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-wwqvv6z"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "不同的TSDB的具体实现虽然千差万别，但是其核心功能基本都包括存储、查询、告警三部分。TSDB接收Prometheus远程写的数据并将数据持久化存储（外部对象存储、本地文件系统等）；Query查询组件接收用户的查询请求，从TSDB获取数据并做聚合、去重等操作并将结果返回给用户；Alert组件根据配置的告警规则进行周期性的评估，如果满足规则设置的阈值则将告警推送到Alertmanager进行告警。"
				}
			]
		},
		{
			"ID": "20221230023411-embeymd",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-embeymd"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "应用层"
				}
			]
		},
		{
			"ID": "20221230023411-6g4hdu9",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-6g4hdu9"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "应用层包含直接面向用户的应用，如Grafana大屏展示、Alertmanager告警分发，当然也包括一些用户自研的组件。"
				}
			]
		},
		{
			"ID": "20221230023411-wsc6rey",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20221230023411-wsc6rey"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "总结"
				}
			]
		},
		{
			"ID": "20221230023411-v41i5on",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023411-v41i5on"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "在大规模集群场景下，节点数量大，采集任务重，如何有效降低每个采集器的采集压力是我们需要重点考虑的问题。同时，面对海量数据的存储需求，需要考虑存储方案的水平可扩展能力。上述的分层架构设计，各层间相对独立，没有强耦合，可以进行独立的方案设计以及容量的扩缩容，从而有效保证整个系统的稳定性。"
				}
			]
		},
		{
			"ID": "20221230023446-aruas90",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221230023446-aruas90",
				"updated": "20221230023446"
			}
		}
	]
}